

<% layout("/layouts/boilerplate") %>

<style>
  .dashboard-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 3rem 0;
    margin-bottom: 2rem;
    border-radius: 10px;
  }
  .empty-state {
    padding: 4rem 2rem;
    text-align: center;
  }
  .empty-state-icon {
    font-size: 5rem;
    color: #cbd5e0;
    margin-bottom: 2rem;
  }
  .card {
    transition: transform 0.2s, box-shadow 0.2s;
  }
  .card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0,0,0,0.1);
  }
  .booking-badge {
    font-size: 0.875rem;
    padding: 0.5rem 1rem;
  }
</style>

<div class="container mt-4 mb-5">
  <!-- Dashboard Header -->
  <div class="dashboard-header text-center shadow-sm">
    <h1 class="display-4 fw-bold mb-2">
      Welcome, <%= user.username %> ðŸ‘‹
    </h1>
    <p class="lead mb-3">Here's a summary of your bookings.</p>
    <a href="/listings" class="btn btn-light btn-lg">
      <i class="fa-solid fa-compass"></i> Browse More Listings
    </a>
  </div>

  <!-- Empty State -->
  <% if ((!current || current.length === 0) && (!upcoming || upcoming.length === 0) && (!past || past.length === 0)) { %>
    <div class="empty-state">
      <div class="empty-state-icon">
        <i class="fa-solid fa-calendar-xmark"></i>
      </div>
      <h3 class="text-muted mb-3">You have no bookings yet.</h3>
      <p class="text-muted mb-4">Start exploring amazing places!</p>
      <a href="/listings" class="btn btn-primary btn-lg">
        <i class="fa-solid fa-home"></i> Book Your First Stay
      </a>
    </div>
  <% } %>

  <% if (current && current.length > 0) { %>
    <section class="mb-5">
      <h4 class="mb-3 text-success">
        <i class="fa-solid fa-house-circle-check"></i> Current Bookings
      </h4>
      <div class="row">
        <% current.forEach(b => { %>
          <div class="col-md-4 mb-4">
            <div class="card shadow-sm h-100 border-success">
              <img src="<%= b.listing.image.url %>" class="card-img-top" alt="<%= b.listing.title %>" style="height: 200px; object-fit: cover;">
              <div class="card-body">
                <h5 class="card-title"><%= b.listing.title %></h5>
                <p class="card-text">
                  <i class="fa-solid fa-location-dot"></i> 
                  <strong>Location:</strong> <%= b.listing.location %>, <%= b.listing.country %>
                </p>
                <p class="card-text">
                  <i class="fa-solid fa-calendar-check"></i> 
                  <strong>Check-In:</strong> <%= b.checkIn.toDateString() %>
                </p>
                <p class="card-text">
                  <i class="fa-solid fa-calendar-xmark"></i> 
                  <strong>Check-Out:</strong> <%= b.checkOut.toDateString() %>
                </p>
                <p class="card-text">
                  <i class="fa-solid fa-indian-rupee-sign"></i> 
                  <strong>Total:</strong> â‚¹<%= b.totalPrice.toLocaleString("en-IN") %>
                </p>
                <span class="badge bg-success">Ongoing Stay</span>
              </div>
              <div class="card-footer bg-white border-0">
                <a href="/listings/<%= b.listing._id %>" class="btn btn-outline-success btn-sm w-100">View Details</a>
              </div>
            </div>
          </div>
        <% }) %>
      </div>
    </section>
  <% } %>

  <% if (upcoming && upcoming.length > 0) { %>
    <section class="mb-5">
      <h4 class="mb-3 text-primary">
        <i class="fa-solid fa-clock"></i> Upcoming Bookings
      </h4>
      <div class="row">
        <% upcoming.forEach(b => { %>
          <div class="col-md-4 mb-4">
            <div class="card shadow-sm h-100 border-primary">
              <img src="<%= b.listing.image.url %>" class="card-img-top" alt="<%= b.listing.title %>" style="height: 200px; object-fit: cover;">
              <div class="card-body">
                <h5 class="card-title"><%= b.listing.title %></h5>
                <p class="card-text">
                  <i class="fa-solid fa-location-dot"></i> 
                  <strong>Location:</strong> <%= b.listing.location %>, <%= b.listing.country %>
                </p>
                <p class="card-text">
                  <i class="fa-solid fa-calendar-check"></i> 
                  <strong>Check-In:</strong> <%= b.checkIn.toDateString() %>
                </p>
                <p class="card-text">
                  <i class="fa-solid fa-calendar-xmark"></i> 
                  <strong>Check-Out:</strong> <%= b.checkOut.toDateString() %>
                </p>
                <p class="card-text">
                  <i class="fa-solid fa-indian-rupee-sign"></i> 
                  <strong>Total:</strong> â‚¹<%= b.totalPrice.toLocaleString("en-IN") %>
                </p>
                <span class="badge bg-primary">Coming Soon</span>
              </div>
              <div class="card-footer bg-white border-0">
                <div class="d-flex gap-2">
                  <a href="/listings/<%= b.listing._id %>" class="btn btn-outline-primary btn-sm flex-grow-1">View</a>
                  <form method="POST" action="/bookings/<%= b._id %>?_method=DELETE" class="flex-grow-1">
                    <button type="submit" class="btn btn-outline-danger btn-sm w-100" 
                            onclick="return confirm('Are you sure you want to cancel this booking?')">
                      Cancel
                    </button>
                  </form>
                </div>
              </div>
            </div>
          </div>
        <% }) %>
      </div>
    </section>
  <% } %>

  <% if (past && past.length > 0) { %>
    <section class="mb-5">
      <h4 class="mb-3 text-secondary">
        <i class="fa-solid fa-history"></i> Past Bookings
      </h4>
      <div class="row">
        <% past.forEach(b => { %>
          <div class="col-md-4 mb-4">
            <div class="card shadow-sm h-100 border-secondary">
              <img src="<%= b.listing.image.url %>" class="card-img-top" alt="<%= b.listing.title %>" style="height: 200px; object-fit: cover;">
              <div class="card-body">
                <h5 class="card-title"><%= b.listing.title %></h5>
                <p class="card-text">
                  <i class="fa-solid fa-location-dot"></i> 
                  <strong>Location:</strong> <%= b.listing.location %>, <%= b.listing.country %>
                </p>
                <p class="card-text">
                  <i class="fa-solid fa-calendar-check"></i> 
                  <strong>Check-In:</strong> <%= b.checkIn.toDateString() %>
                </p>
                <p class="card-text">
                  <i class="fa-solid fa-calendar-xmark"></i> 
                  <strong>Check-Out:</strong> <%= b.checkOut.toDateString() %>
                </p>
                <p class="card-text">
                  <i class="fa-solid fa-indian-rupee-sign"></i> 
                  <strong>Total:</strong> â‚¹<%= b.totalPrice.toLocaleString("en-IN") %>
                </p>
                <span class="badge bg-secondary">Completed</span>
              </div>
              <div class="card-footer bg-white border-0">
                <a href="/listings/<%= b.listing._id %>" class="btn btn-outline-secondary btn-sm w-100">View Listing</a>
              </div>
            </div>
          </div>
        <% }) %>
      </div>
    </section>
  <% } %>
</div>

<style>
  .card {
    transition: transform 0.2s;
  }
  .card:hover {
    transform: translateY(-5px);
  }
</style>